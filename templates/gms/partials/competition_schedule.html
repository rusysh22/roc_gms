{% load static %}

<style>
    .view-btn.active {
        background-color: #4f46e5; /* indigo-600 */
        color: white;
    }
    .schedule-view {
        display: none;
    }
    .schedule-view.active {
        display: block;
    }
</style>

<div class="bg-white rounded-xl shadow-md dark:bg-gray-800">
    <!-- View Switcher -->
    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-end items-center space-x-2">
        <span class="text-sm font-medium text-gray-600 dark:text-gray-300">View as:</span>
        <div class="flex rounded-md shadow-sm" role="group">
            <button type="button" class="view-btn active rounded-l-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 py-2 px-4 text-sm font-medium text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600" data-view="table-view">
                Table
            </button>
            <button type="button" class="view-btn rounded-r-md border-t border-b border-r border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 py-2 px-4 text-sm font-medium text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600" data-view="grid-view">
                Grid
            </button>
        </div>
    </div>

    {% if matches %}
    <!-- Table View -->
    <div id="table-view" class="schedule-view active">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-700/50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date & Time</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Home Club</th>
                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Score</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Away Club</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Venue</th>
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                    {% for item in matches_with_scores %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ item.match.scheduled_time|date:"D, M d, Y, H:i" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white text-right">{{ item.match.home_team.name|default:"TBD" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center font-bold text-gray-800 dark:text-gray-100">
                            {% if item.home_score is not None and item.away_score is not None %}
                                {{ item.home_score }} - {{ item.away_score }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">{{ item.match.away_team.name|default:"TBD" }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300">{{ item.match.venue.name|default:"Not set" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Grid View -->
    <div id="grid-view" class="schedule-view p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for match in matches %}
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 flex flex-col justify-between hover:shadow-lg transition-shadow duration-200">
                <div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Round {{ match.round_number|default:"N/A" }}</p>
                    <p class="font-bold text-md my-2 text-gray-800 dark:text-gray-100">
                        {{ match.home_team.name|default:"TBD" }} <br/>vs<br/> {{ match.away_team.name|default:"TBD" }}
                    </p>
                </div>
                <div class="mt-4 text-xs text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-600 pt-2">
                    <p><span class="font-semibold">When:</span> {{ match.scheduled_time|date:"M d, Y, H:i" }}</p>
                    <p><span class="font-semibold">Venue:</span> {{ match.venue.name|default:"Not set" }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
        <p>No matches scheduled for this competition yet.</p>
    </div>
    {% endif %}
</div>

<script>
    (function() {
        const tabContent = document.getElementById('tab-content');
        if (tabContent.dataset.scheduleViewInitialized) {
            return;
        }
        tabContent.dataset.scheduleViewInitialized = 'true';

        const viewButtons = tabContent.querySelectorAll('.view-btn');
        const views = tabContent.querySelectorAll('.schedule-view');

        viewButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetViewId = button.dataset.view;

                viewButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                views.forEach(view => {
                    if (view.id === targetViewId) {
                        view.classList.add('active');
                    } else {
                        view.classList.remove('active');
                    }
                });
            });
        });
    })();
</script>